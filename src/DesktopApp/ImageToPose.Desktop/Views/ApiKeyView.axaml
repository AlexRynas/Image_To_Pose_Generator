<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:ImageToPose.Desktop.ViewModels"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
             x:Class="ImageToPose.Desktop.Views.ApiKeyView"
             x:DataType="vm:ApiKeyViewModel">
    
    <ScrollViewer HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Auto">
        <StackPanel MaxWidth="600" Margin="40" Spacing="20">
            <TextBlock Text="OpenAI API Key" 
                       FontSize="28" 
                       FontWeight="Bold" 
                       Margin="0,0,0,10"/>
            
            <TextBlock TextWrapping="Wrap" FontSize="14">
                To use this application, you need an OpenAI API key. The key will be used to analyze images and generate pose descriptions.
            </TextBlock>
            
            <StackPanel Spacing="8">
                <TextBlock Text="API Key:" FontWeight="SemiBold"/>
                <TextBox Text="{Binding ApiKey, UpdateSourceTrigger=PropertyChanged}" 
                         Watermark="sk-..." 
                         PasswordChar="*"
                         FontSize="14"/>
                <TextBlock FontSize="12" Foreground="{DynamicResource Brush.TextMuted}">
                    Don't have an API key? 
                    <TextBlock.ContextMenu>
                        <ContextMenu>
                            <MenuItem Header="Open API Keys Page" Command="{Binding OpenApiKeyLinkCommand}"/>
                        </ContextMenu>
                    </TextBlock.ContextMenu>
                </TextBlock>
                <Button Content="Create or manage your API keys" 
                        Command="{Binding OpenApiKeyLinkCommand}"
                        HorizontalAlignment="Left"
                        Margin="0,4,0,0"/>
            </StackPanel>
            
            <!-- Error Message -->
            <Border Background="{DynamicResource Brush.Danger}"
                    BorderBrush="{DynamicResource Brush.Border}" 
                    BorderThickness="1" 
                    CornerRadius="8" 
                    Padding="12"
                    IsVisible="{Binding ErrorMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                <TextBlock Text="{Binding ErrorMessage}" 
                           TextWrapping="Wrap" 
                           Foreground="White"/>
            </Border>
            
            <!-- Success Message -->
            <Border Background="{DynamicResource Brush.Success}" 
                    BorderBrush="{DynamicResource Brush.Border}" 
                    BorderThickness="1" 
                    CornerRadius="8" 
                    Padding="12"
                    IsVisible="{Binding IsValid}">
                <TextBlock Text="API key validated successfully!" 
                           TextWrapping="Wrap" 
                           Foreground="White"
                           FontWeight="SemiBold"/>
            </Border>
            
            <!-- Validating Indicator -->
            <StackPanel Orientation="Vertical" Spacing="10" IsVisible="{Binding IsValidating}" HorizontalAlignment="Stretch">
                <ProgressBar IsIndeterminate="True" Height="4" HorizontalAlignment="Stretch"/>
                <TextBlock Text="Validating API key..." HorizontalAlignment="Center" TextAlignment="Center"/>
            </StackPanel>
            
            <Button Content="Validate and Continue" 
                    Command="{Binding ValidateAndContinueCommand}"
                    IsEnabled="{Binding CanValidateAndContinue}"
                    HorizontalAlignment="Center"
                    FontSize="16"
                    Padding="30,12"
                    Margin="0,20,0,0"/>
            
            <Border Background="{DynamicResource Brush.Info}" 
                    BorderBrush="{DynamicResource Brush.Border}" 
                    BorderThickness="1" 
                    CornerRadius="8" 
                    Padding="16"
                    Margin="0,20,0,0">
                <StackPanel Spacing="8">
                    <TextBlock Text="Privacy Note" FontWeight="Bold" FontSize="14"/>
                    <TextBlock TextWrapping="Wrap" FontSize="13">
                        Your API key is stored in memory only for this session. It is never saved to disk or transmitted anywhere except to OpenAI's servers for processing your requests.
                    </TextBlock>
                </StackPanel>
            </Border>
        </StackPanel>
    </ScrollViewer>
</UserControl>
